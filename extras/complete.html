<html lang=en><title>Wavefunction Simulator</title><link href=https://fonts.googleapis.com rel=preconnect><link href=https://fonts.gstatic.com rel=preconnect crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap"rel=stylesheet><style>body{font-family:Roboto,sans-serif;background-color:#3f424a;color:#fff;padding-left:16px;padding-right:16px;zoom:.9;-moz-transform:scale(.9);-moz-transform-origin:0 0}.inline{display:inline}.flex-container{display:flex}.flex-center{justify-content:center}.flex-row{flex-direction:row;flex-wrap:wrap}.flex-column{flex-direction:column}.flex-child{margin:4px}#canvas-container{width:600px;height:600px;margin-left:8px;margin-right:8px}#canvas{width:100%;height:100%;background-color:#000;border:2px solid #a0a0a0;margin:0;top:0;left:0;border-radius:16px;cursor:pointer}#title{width:600px;margin:auto}#parameters-outer{margin-left:8px;margin-right:8px;min-height:650px}#parameters-inner{border:2px solid #a0a0a0;border-radius:16px;padding-left:16px;padding-right:16px;min-height:600px;background-color:#303338;padding-bottom:8px;min-width:250px;height:100%}.header{text-align:center}.parameters-text{margin:8px 8px 8px 32px}hr{margin:0;height:1px;background-color:gray;border:0}.parameters-head{margin-left:8px;margin-right:8px}#update{border-width:2px;cursor:pointer;width:100%;color:#fff;padding:6px 22px;margin-bottom:12px;background-color:rgba(81,81,81,.5)}.input{color:#fff;padding:6px 8px;border-color:#a0a0a0;border-style:solid;border-radius:6px;box-shadow:0 0 4px 0#303030 inset;background-color:#515151;cursor:text;word-wrap:break-word;transition-duration:.5s;transition-timing-function:ease-in-out}.input:focus{color:#bbff8d;font-weight:900}.label{margin-right:2px}.iblock{padding:8px;width:100%}.center{margin:auto;width:100%}#console{margin-top:12px;width:866px;border:2px solid #a0a0a0;border-radius:16px;padding-left:16px;padding-right:16px;min-height:200px;background:#191a1c}#console-p{text-align:left;word-wrap:break-word}#t{padding-bottom:10px}#outputs .parameter-group .parameters-text{padding-bottom:0}#outputs hr{margin-top:14px}#r1{height:fit-content!important}#canvas-xaxis{width:600px;height:50px;background-color:#1d1d1f;border:2px solid #a0a0a0;border-radius:16px;margin-top:8px;margin-bottom:-8px;display:flex;flex:0 1 auto;align-self:flex-end}#temporary-text{margin:auto}.tooltip{border-bottom:2px dotted rgba(184,184,184,.153)}.tooltip .computation-tooltip,.tooltip .states-tooltip{opacity:0;visibility:hidden;background-color:rgba(0,0,0,.5);width:auto;color:#fff;text-align:center;border-radius:6px;position:absolute;margin-left:200px;z-index:1;padding:5px 16px;transition-duration:.2s}.tooltip .states-tooltip{margin-top:-50px}.tooltip:hover .computation-tooltip,.tooltip:hover .states-tooltip{opacity:1;visibility:visible;backdrop-filter:blur(3px)}.tooltip:hover .states-tooltip{margin-left:170px}.tooltip .computation-tooltip::after,.tooltip .states-tooltip::after{content:" ";position:absolute;right:100%;margin-top:-5px;border-width:5px;border-style:solid;border-color:transparent rgba(0,0,0,.5) transparent transparent}.tooltip .states-tooltip::after{top:35px}.tooltip .computation-tooltip{margin-top:-60px}.tooltip:hover .computation-tooltip{margin-left:250px}.tooltip .computation-tooltip::after{top:45px}.computation-tooltip p,.states-tooltip p{font-size:12px}#V{width:200px;margin-left:4px}#Vlabel{float:left}#potential::after,#substep-tip::after{top:20px}#FPS{margin-left:120px}#O{position:relative;left:76px;top:-18px}#substep-tip{margin-left:125px}.reset-cursor{cursor:default}#src{width:100%;text-align:center;color:#fff;vertical-align:middle;line-height:45px;transition-duration:.4s}#src:hover{color:#2daceb}#subrec{margin-top:-15px}#M,#start{cursor:pointer}#outputs .tooltip .parameters-text{margin-left:24px}#start{position:relative;width:300px;background-color:rgba(246,37,37,.62);padding:12px 16px;border-radius:8px;border:2px solid #a0a0a0;box-shadow:0 0 11px 0#370437}#start p{margin:0;color:#fff;font-size:16px;transition-duration:.5s}#start:active{background-color:rgba(135,5,5,.62)}#blurry{width:100%;height:150%;backdrop-filter:blur(4px);position:absolute;top:0;left:0;z-index:2;background-image:linear-gradient(to right,rgba(10,41,66,.4)0,rgba(133,113,146,.33) 33%,rgba(137,31,57,.41) 100%)}#front{z-index:3;position:relative}</style><link href=/img/icon.ico rel=icon type=image/x-icon><meta charset=UTF-8><meta content="IE=edge"http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1"name=viewport><meta content="Miles Waugh"name=author><meta content="quantum, wave, function, wavefunction, simulator, evolution, schrodinger, schroedinger, schrÃ¶dinger, time-dependent, numeric, github, miles, waugh, canvas"name=keywords><body onload=setup()><div id=mainbox><div id=title><h1 class="reset-cursor header">Wavefunction Simulator</h1></div><div class="flex-container flex-column flex-center"><div class="flex-container flex-center flex-row"id=r1><div class="flex-container flex-column"><div class=flex-child id=canvas-container style="flex:0 0 600px"><canvas height=600 id=canvas width=600></canvas></div><div class=flex-child id=canvas-xaxis><a href=https://github.com/piano-miles/Wavefunction-Simulator id=src>View the code on GitHub</a></div></div><div class=flex-child id=parameters-outer><div class="flex-container flex-column"id=parameters-inner><div class="flex-child parameters-div header"id=parameters><h2 class="reset-cursor parameters-head"id=parameters-header>Parameters</h2></div><hr><div class="flex-child parameters-div"id=inputs><h3 class="reset-cursor parameters-head">Inputs</h3><div class=iblock><label class=label id=Vlabel>V:</label><div class=tooltip><textarea class=input id=V type=text>x*x/2e2</textarea><div class=computation-tooltip id=potential><p>This is the <a href=https://en.wikipedia.org/wiki/Potential_energy style=color:#6bc5f5 target=_blank>potential</a>.</div></div></div><div class=iblock><label class="reset-cursor label">Substeps:</label><div class=tooltip><span class=input contenteditable=""id=O role=textbox>80</span><div class=states-tooltip id=substep-tip><p>The number of evolution gradations within a frame.<p>Normalization is performed every five steps.</div></div><p></div><pre id=subrec class=parameters-text>(substep rec: )</pre><div class=center><button id=update>Update</button></div><div id=front><div class="reset-cursor iblock"id=checkdiv><input checked class=checkbox id=M onchange=resolve(this) type=checkbox> <label class=label>Pause</label></div><button id=start onclick=resolve(this)><p>To begin, uncheck this 'pause' box. Click this message to hide it.<p style=margin-top:12px>You may hover over various parameters for more elaboration on what they mean.</button></div><div id=blurry></div></div><hr><div class="flex-child parameters-div"id=outputs><div class=parameter-group><h3 class="reset-cursor parameters-head">States</h3><div class=tooltip><pre id=t class=parameters-text>t     = 0.000 zs</pre><div class=states-tooltip><p>The global time passed since initialization.<p>(zs = zeptoseconds)</div></div><div class=tooltip><pre id=xscl class=parameters-text>width = 4.634 pm</pre><div class=states-tooltip><p>The width of the viewport window.<p>(pm = picometers)</div></div></div><hr><div class=parameter-group><h3 class="reset-cursor parameters-head">Computation Breakdown</h3><div class=tooltip><pre id=t1 class=parameters-text>Evolution (ms):    </pre><div class=computation-tooltip><p>Time spent evolving and normalizing the wavefunction.<p>(1-second average per frame, in milliseconds)</div></div><div class=tooltip><pre id=t2 class=parameters-text>Render    (ms):    </pre><div class=computation-tooltip><p>Time spent rendering the components on the viewport.<p>(1-second average per frame, in milliseconds)</div></div><div class=tooltip><pre id=t3 class=parameters-text>Other     (ms):    </pre><div class=computation-tooltip><p>Time spent doing other stuff. (Obviously)<p>(1-second average per frame, in milliseconds)</div></div></div><hr><div class=parameter-group><h3 class="reset-cursor parameters-head">Other</h3><div class=tooltip><pre id=fps class=parameters-text>FPS:    </pre><div class=states-tooltip id=FPS><p>Frames rendered per second.</div></div></div></div></div></div></div><div class=flex-child><div class="flex-container flex-column center"id=console><h2 class=reset-cursor>Console</h2><hr><pre id=console-p contenteditable=""style=color:#fff>To begin, please uncheck the "pause" box.</pre></div></div></div></div><script>var L;function setup(){let e=document.getElementById("canvas"),t=document.getElementById("console-p");if(L=function(){let e=arguments;if(3==e.length||4==e.length&&e[3]){let n=e[0],$=e[1],o=e[2];"red"==$?$="#ed2f2f":"green"==$?$="#c4ffad":"white"==$&&($="#ffffff"),t.style.color=$,"add"==o?t.innerHTML+=n:t.innerHTML=n}else if(e[3])throw"Incorrect number of arguments passed ("+e.length+")."},e.getContext)e.width=600,e.height=600,draw();else if(e.outerHTML)try{e.outerHTML="<h1>There was an issue with canvas.</h1>"}finally{L("Uh oh. Looks like there's a problem with canvas.","red","set")}}function draw(){let canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),width=600,height=600;ctx.globalCompositeOperation="destination-over";let J=600,I=1,tscale=1,Vscale=5,maths=["abs","acos","asin","atan","cbrt","ceil","cos","cosh","exp","floor","hypot","log","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc"],t1=document.getElementById("t1"),t2=document.getElementById("t2"),t3=document.getElementById("t3"),R=document.getElementById("V"),time_display=document.getElementById("t"),N=document.getElementById("fps"),K=document.getElementById("O"),S=document.getElementById("subrec"),M=document.getElementById("M"),P=document.getElementById("console-p"),width_display=document.getElementById("xscl"),fps=0,O=80,global_time=0,dt=.001,dtsc=dt/O,dtsch=.5*dtsc,dtscs=dtsc/6,dx=.02,dx2=1/(dx*dx),init=!0,V=[],Vfunc="",wfunc=Array(600).fill([0,0]),wf2=Array(600).fill(0),t1acc=0,t2acc=0,t3acc=0,frame=0,toacc=0,times=[],range=Array.from(Array(600),(e,t)=>t),lrange=Array.from(Array(598),(e,t)=>t+1);function A(){V=[];for(let x=-300;x<300;x++)V.push(eval(Vfunc))}function C(e,t){return[Math.cos(e)*t,Math.sin(e)*t]}function B(e,t){let n="d0";ctx.lineWidth=2,ctx.strokeStyle="#cc5050"+n,ctx.beginPath(),ctx.moveTo(0,300-V[0]*Vscale);for(let $=1;$<600;$++)ctx.lineTo($,300-V[$]*Vscale);ctx.stroke(),ctx.fillStyle="#ffffff20",ctx.strokeStyle="#cccccc"+n,pdfscale=300/Math.max.apply(null,t),ctx.beginPath(),ctx.moveTo(0,300);for(let o=0;o<t.length;o++){let i=300-t[o]*pdfscale;ctx.lineTo(o,i)}ctx.lineTo(600,300),ctx.stroke(),ctx.closePath(),ctx.fill(),ctx.strokeStyle="#f79368"+n,ctx.beginPath(),ctx.moveTo(0,300-e[0][0]*J);for(let s=1;s<e.length;s++){let r=300-e[s][0]*J;ctx.lineTo(s,r)}ctx.stroke(),ctx.strokeStyle="#68b7f7"+n,ctx.beginPath(),ctx.moveTo(0,300-e[0][1]*J);for(let a=1;a<e.length;a++){let c=300-e[a][1]*J;ctx.lineTo(a,c)}ctx.stroke()}function sqa(e){return e.map(e=>e[0]*e[0]+e[1]*e[1])}function G(e,t){if(RMS=0,t.forEach(e=>RMS+=e),RMS<=0)throw"There is an issue with your wavefunction.";return RMS=Math.sqrt(RMS),e.map(e=>e.map(e=>e/RMS))}function D(){console.log("updating inputs");let vin=R.value.trim();maths.forEach(e=>vin.replace(e,"Math."+e)),success=!1;try{for(let x=0;x<600;x++){let y=eval(vin)+0}Vfunc=vin,A(),L("Successfully updated V to "+Vfunc+"\n","green","set");let H=K.innerHTML.trim();try{(H=Math.floor(H)+0)>0&&H<1/0?(O=H,L("Successfully updated O to "+O,"green","add"),success=!0):L("ERROR:\nUpdating O:\nInvalid value.\nPlease make sure it is a positive non-zero int.","red","add")}catch(error){L("ERROR:\nUpdating O:\n"+error,"red","add")}}catch(error){L("ERROR:\nUpdating potential:\n"+error,"red","set")}success&&(ctx.clearRect(0,0,canvas.width,canvas.height),B(wfunc,wf2),dtsch=.5*(dtsc=dt/O),dtscs=dtsc/6,dx2=1/(dx*dx),width_display.innerHTML="width = "+(dx*width*.3862).toFixed(3)+" pm")}function E(){for(let e=0;e<600;e++){let t=(e-300)*.01,n=C(7*t,Math.exp(-t*t*100));wfunc[e]=n;let $=n[0]*n[0]+n[1]*n[1];wf2[e]=$}wf2=sqa(wfunc),wf2=sqa(wfunc=G(wfunc,wf2)),D(!1),L('To begin, please uncheck the "pause" box.',"white","set")}let F=e=>{let t=lrange.map(t=>[(e[t-1][0]+e[t+1][0]-2*e[t][0])*dx2,(e[t-1][1]+e[t+1][1]-2*e[t][1])*dx2]);return t.unshift(t[0]),t.push(t[t.length-1]),t};function dydt(e){let t=(l=F(e)).map(e=>[-.5*e[1],.5*e[0]]);return range.map(n=>[e[n][1]*V[n]+t[n][0],-e[n][0]*V[n]+t[n][1]])}function Q(e){let t=dydt(e),n=dydt(range.map(n=>[e[n][0]+t[n][0]*dtsch,e[n][1]+t[n][1]*dtsch])),$=dydt(range.map(t=>[e[t][0]+n[t][0]*dtsch,e[t][1]+n[t][1]*dtsch])),o=dydt(range.map(t=>[e[t][0]+$[t][0]*dtsc,e[t][1]+$[t][1]*dtsc])),i=range.map(i=>[e[i][0]+(t[i][0]+2*n[i][0]+2*$[i][0]+o[i][0])*dtscs,e[i][1]+(t[i][1]+2*n[i][1]+2*$[i][1]+o[i][1])*dtscs]);return i[0]=[0,0],i[i.length-1]=[0,0],i}function update(){if(!M.checked){let e=times[times.length-1];(times=[]).push(e),ctx.clearRect(0,0,canvas.width,canvas.height),times.push(performance.now());for(let t=0;t<O;t++)wfunc=Q(wfunc),t%5==0&&(wf2=sqa(wfunc),wfunc=G(wfunc,wf2));if(times.push(performance.now()),B(wfunc,wf2),times.push(performance.now()),t3acc+=times[1]-times[0],t1acc+=times[2]-times[1],t2acc+=times[3]-times[2],toacc+=times[3]-times[1],frame%60==0){let n=t1acc+t2acc+t3acc;t1.innerHTML=`Evolution (ms): ${(t1acc/60).toFixed(2)} (${Math.round(100*t1acc/n)}%)`,t2.innerHTML=`Render    (ms): ${(t2acc/60).toFixed(2)} (${Math.round(100*t2acc/n)}%)`,t3.innerHTML=`Other     (ms): ${(t3acc/60).toFixed(2)} (${Math.round(100*t3acc/n)}%)`,fps=6e4/toacc,N.innerHTML="FPS: "+fps.toFixed(1),subrec=10*Math.round(O*fps/400),S.innerHTML="(substep rec: "+subrec+")",t1acc=0,t2acc=0,t3acc=0,toacc=0}global_time+=dt,time_display.innerHTML="t     = "+(1.288*global_time).toPrecision(4)+" zs",++frame>=240&&(frame=0)}requestAnimationFrame(update)}document.getElementById("update").addEventListener("click",e=>{D()}),E(),init=!1,update()}</script><script>function resolve(e){e.checked||(document.getElementById("start").remove(),document.getElementById("blurry").remove())}</script>